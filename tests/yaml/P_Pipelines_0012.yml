resources:
  - name: P_Pipelines_0012_gitRepo
    type: GitRepo
    configuration:
      gitProvider: s_gitHub
      path: Varsha-Arun/pipelines

pipelines:

  - name: P_Pipelines_0012_ImagePush
    configuration:
      environmentVariables:
        readOnly:
          image_tag: latest
    steps:
      - name: P_Pipelines_0012_ImagePush
        type: Bash
        configuration:
          inputResources:
            - name: P_Pipelines_0012_gitRepo
          integrations:
            - name: i_artifactoryRegistry
            - name: s_artifactory
        execution:
          onExecute:
            - printenv
            - pushd $res_P_Pipelines_0012_gitRepo_resourcePath
            - docker build -t $int_s_artifactory_url/docker-local/jfreq:$image_tag .
            - jfrog rt c entplus --url=$int_s_artifactory_url --user=$int_s_artifactory_user --apikey=$int_s_artifactory_apikey
            - jfrog rt docker-push $int_s_artifactory_url/docker-local/jfreq:$image_tag docker-local

  - name: P_Pipelines_0012
    configuration:  
      environmentVariables:
        readOnly:
          image_tag: latest
      runtime:       
        type: image
        image:
          custom:
            registry: i_artifactoryRegistry
            sourceRepository: docker-local 
            name: $int_s_artifactory_url/docker-local/jfreq
            tag: $image_tag
            autoPull: true
    steps:
      - name: P_Pipelines_0012
        type: Bash
        execution:
          onExecute:
            - |
              [ $step_image_name == $int_s_artifactory_url/docker-local/jfreq ] 
            - |
              [ $step_image_tag == $image_tag ]
